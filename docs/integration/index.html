<!DOCTYPE html>
<html lang='en-US' xml:lang='en-US' xmlns='http://www.w3.org/1999/xhtml'>
  <head>
    <meta content='text/html; charset=utf-8' http-equiv='Content-Type'>
    <title>Mongoid Documentation: Integration</title>
    <link href='/stylesheets/docs.css' media='all' rel='stylesheet' type='text/css'>
  </head>
  <body>
    <div id='docs'>
      <div id='page_menu'>
        <ul>
          <li class=''>
            <a href='/'>Home</a>
          </li>
          <li class='current_page_item'>
            <a href='/docs/installation/'>Documentation</a>
          </li>
          <li class=''>
            <a href='/links/'>Links</a>
          </li>
          <li class=''>
            <a href='/about/'>About</a>
          </li>
        </ul>
      </div>
      <div id='header'>
        <a href='/'>
          <h1 class='logo' title='[mon-goyd]'>MONGOID</h1>
        </a>
        <a class='docs_header' href='../installation/'>Documentation</a>
      </div>
      <div class='main'>
        <div class='border'>
          <div class='content_body colorize'>
            <h2>Integration</h2>
            <div class="title">Carrierwave</div>&#x000A;<div class="text">&#x000A;  <p>&#x000A;    Support for Mongoid exists in&#x000A;    <a href="http://github.com/jnicklas/carrierwave">Carrierwave</a>&#x000A;    for doing file attachments, and you may specify them to be files or&#x000A;    S3 currently. If no <tt>:mount_on</tt> option is provided to the uploader,&#x000A;    the filename will get stored in a field with "_filename" appended&#x000A;    to the name of the uploader.&#x000A;  </p>&#x000A;  <pre><code class="language-ruby"><span class="r">class</span> <span class="cl">User</span>&#x000A;  include <span class="co">Mongoid</span>::<span class="co">Document</span>&#x000A;  mount_uploader <span class="sy">:avatar</span>, <span class="co">AvatarUploader</span> <span class="c">#field is avatar_filename</span>&#x000A;<span class="r">end</span></code></pre>&#x000A;</div>&#x000A;<div class="title">Cucumber</div>&#x000A;<div class="text">&#x000A;  <p>&#x000A;    Since MongoDB does not support transactions, you will want to add a&#x000A;    hook to <a href="http://github.com/aslakhellesoy/cucumber">Cucumber</a>&#x000A;    that ensures the database is clean before each feature.&#x000A;  </p>&#x000A;  <p>&#x000A;    In <tt>features/support/hooks.rb</tt>:&#x000A;  </p>&#x000A;  <pre><code class="language-ruby"><span class="co">Mongoid</span>.master.collections.select <span class="r">do</span> |collection|&#x000A;  collection.name !~ <span class="rx"><span class="dl">/</span><span class="k">system</span><span class="dl">/</span></span>&#x000A;<span class="r">end</span>.each(&amp;<span class="sy">:drop</span>)</code></pre>&#x000A;  <p>&#x000A;    If you are using the <tt><a href="http://github.com/bmabey/database_cleaner">database_cleaner</a></tt> gem,&#x000A;    instead just create a file called <tt>features/support/database_cleaner.rb</tt> with the content:&#x000A;  </p>&#x000A;  <pre><code class="language-ruby">require <span class="s"><span class="dl">'</span><span class="k">database_cleaner</span><span class="dl">'</span></span>&#x000A;<span class="co">DatabaseCleaner</span>.strategy = <span class="sy">:truncation</span>&#x000A;<span class="co">DatabaseCleaner</span>.orm = <span class="s"><span class="dl">"</span><span class="k">mongoid</span><span class="dl">"</span></span>&#x000A;<span class="co">Before</span> { <span class="co">DatabaseCleaner</span>.clean }</code></pre>&#x000A;</div>&#x000A;<div class="title">RSpec</div>&#x000A;<div class="text">&#x000A;  <p>&#x000A;    Similar to Cucumber, <a href="http://github.com/rspec">Rspec</a>'s&#x000A;    <tt>use_transactional_fixtures</tt> option will have no affect on Mongoid,&#x000A;    so you can clean up your specs after the suite.&#x000A;  </p>&#x000A;  <p>&#x000A;    In <tt>spec/spec_helper.rb</tt>:&#x000A;  </p>&#x000A;  <pre><code class="language-ruby"><span class="co">Rspec</span>.configure <span class="r">do</span> |config|&#x000A;  config.after <span class="sy">:suite</span> <span class="r">do</span>&#x000A;    <span class="co">Mongoid</span>.master.collections.select <span class="r">do</span> |collection|&#x000A;      collection.name !~ <span class="rx"><span class="dl">/</span><span class="k">system</span><span class="dl">/</span></span>&#x000A;    <span class="r">end</span>.each(&amp;<span class="sy">:drop</span>)&#x000A;  <span class="r">end</span>&#x000A;<span class="r">end</span></code></pre>&#x000A;  <p>&#x000A;    You may also do this after <tt>:each</tt> as well if you have a lot of&#x000A;    integration spec, but note it will be slower.&#x000A;  </p>&#x000A;  <p>&#x000A;    If you are using the <tt><a href="http://github.com/bmabey/database_cleaner">database_cleaner</a></tt> gem,&#x000A;    you can instead add these lines to your RSpec configure block <tt>spec/spec_helper.rb</tt>:&#x000A;  </p>&#x000A;  <pre><code class="language-ruby"><span class="co">Rspec</span>.configure <span class="r">do</span> |config|&#x000A;  require <span class="s"><span class="dl">'</span><span class="k">database_cleaner</span><span class="dl">'</span></span>&#x000A;  config.before(<span class="sy">:suite</span>) <span class="r">do</span>&#x000A;    <span class="co">DatabaseCleaner</span>.strategy = <span class="sy">:truncation</span>&#x000A;    <span class="co">DatabaseCleaner</span>.orm = <span class="s"><span class="dl">"</span><span class="k">mongoid</span><span class="dl">"</span></span>&#x000A;  <span class="r">end</span>&#x000A;&#x000A;  config.before(<span class="sy">:each</span>) <span class="r">do</span>&#x000A;    <span class="co">DatabaseCleaner</span>.clean&#x000A;  <span class="r">end</span>&#x000A;<span class="r">end</span></code></pre>&#x000A;</div>&#x000A;<div class="title">Devise</div>&#x000A;<div class="text">&#x000A;  <p>&#x000A;    In order to get <a href="http://github.com/plataformatec/devise">Devise</a>&#x000A;    set up to work with Mongoid, all you will need to do is remove the&#x000A;    ActiveRecord require and replace it with the Mongoid one.&#x000A;  </p>&#x000A;  <p>&#x000A;    In <tt>config/initializers/devise.rb</tt>:&#x000A;  </p>&#x000A;  <pre><code class="language-ruby"><span class="c"># ==&gt; ORM configuration</span>&#x000A;<span class="c"># Load and configure the ORM. Supports :active_record (default),</span>&#x000A;<span class="c"># :mongoid (bson_ext recommended) and :data_mapper (experimental).</span>&#x000A;require <span class="s"><span class="dl">"</span><span class="k">devise/orm/mongoid</span><span class="dl">"</span></span></code></pre>&#x000A;</div>&#x000A;<div class="title">Passenger</div>&#x000A;<div class="text">&#x000A;  <p>&#x000A;    The MongoDB wiki will alert you of an initializer that you need to include&#x000A;    if you are using <a href="http://www.modrails.com/">Passenger</a>&#x000A;    with smart spawning enabled. (Conservative spawning is the default.)&#x000A;    In the case of Mongoid you will <i>NOT</i> need to do this as Mongoid detects&#x000A;    if Passenger is running in this mode and will reconnect for you when&#x000A;    a worker is forked.&#x000A;  </p>&#x000A;</div>&#x000A;<div class="title">Unicorn</div>&#x000A;<div class="text">&#x000A;  <p>&#x000A;    No extra configuration is needed for Mongoid if you are using&#x000A;    <a href="http://unicorn.bogomips.org/">Unicorn</a>&#x000A;    with <tt>preload_app</tt> set to <tt>true</tt>. Mongoid will detect if&#x000A;    Unicorn has forked a child worker and will reconnect to the database&#x000A;    on the next query.&#x000A;  </p>&#x000A;</div>&#x000A;&#x000A;
          </div>
        </div>
      </div>
      <div id='rightcolumn'>
        <div class='box' id='search'>
          <div class='roundedbox'>
            <h3>Contents</h3>
          </div>
        </div>
        <ul class='outline'>
          <li><a href="/docs/installation/">Installation</a></li>
          <li><a href="/docs/documents/">Documents</a></li>
          <li><a href="/docs/associations/">Associations</a></li>
          <li><a href="/docs/persistence/">Persistence</a></li>
          <li><a href="/docs/querying/">Querying</a></li>
          <li><a href="/docs/callbacks/">Callbacks</a></li>
          <li><a href="/docs/validation/">Validation</a></li>
          <li><a href="/docs/inheritance/">Inheritance</a></li>
          <li><a href="/docs/indexing/">Indexing</a></li>
          <li><a href="/docs/extras/">Extras</a></li>
          <li><a href="/docs/rake/">Rake Tasks</a></li>
          <li><span class="active" title="You're here.">Integration</span></li>
          <li><a href="/docs/extensions/">Extensions</a></li>
          <li><a href="/docs/upgrading/">Upgrading</a></li>
        </ul>
      </div>
      <div id='footer'>
        <p>
          Mongoid is maintained by <a href="http://twitter.com/modetojoy">Durran Jordan</a>, Site by <a href="http://twitter.com/railsjedi">@railsjedi</a> and <a href="http://twitter.com/fredrikhenne">@fredrikhenne</a>. Mongoid is free software under the MIT license.
        </p>
      </div>
    </div>
    <div id='ribbon'>
      <p>
        <a href='http://github.com/mongoid/mongoid-site' rel='me' title='Fork me on GitHub!'>Fork me on GitHub!</a>
      </p>
    </div>
  </body>
</html>
