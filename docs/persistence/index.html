<!DOCTYPE html>
<html lang='en-US' xml:lang='en-US' xmlns='http://www.w3.org/1999/xhtml'>
  <head>
    <meta content='text/html; charset=utf-8' http-equiv='Content-Type'>
    <title>Mongoid Documentation: Persistence</title>
    <link href='/stylesheets/docs.css' media='all' rel='stylesheet' type='text/css'>
  </head>
  <body>
    <div id='docs'>
      <div id='page_menu'>
        <ul>
          <li class=''>
            <a href='/'>Home</a>
          </li>
          <li class='current_page_item'>
            <a href='/docs/installation/'>Documentation</a>
          </li>
          <li class=''>
            <a href='/links/'>Links</a>
          </li>
          <li class=''>
            <a href='/about/'>About</a>
          </li>
        </ul>
      </div>
      <div id='header'>
        <a href='/'>
          <h1 class='logo' title='[mon-goyd]'>MONGOID</h1>
        </a>
        <a class='docs_header' href='../installation/'>Documentation</a>
      </div>
      <div class='main'>
        <div class='border'>
          <div class='content_body colorize'>
            <h2>Persistence</h2>
            <div class="text">&#x000A;  Mongoid supports all ActiveRecord-style methods for persistence operations on the database.&#x000A;  Please note the new persistence strategy section for examples with the corresponding database&#x000A;  queries that would be executed.&#x000A;  <br><br>&#x000A;</div>&#x000A;<div class="title">Create</div>&#x000A;<div class="text">&#x000A;  Instantiating a new object and saving it to the database in a single call is handled with&#x000A;  <tt>Document.create</tt> or <tt>Document.create!</tt>. Use the latter if you wish an&#x000A;  exception to be raised if validation fails.&#x000A;  <pre><code class="language-ruby">person = <span class="co">Person</span>.create(<span class="sy">:first_name</span> =&gt; <span class="s"><span class="dl">"</span><span class="k">Syd</span><span class="dl">"</span></span>, <span class="sy">:last_name</span> =&gt; <span class="s"><span class="dl">"</span><span class="k">Vicious</span><span class="dl">"</span></span>)&#x000A;person = <span class="co">Person</span>.create!(<span class="sy">:first_name</span> =&gt; <span class="s"><span class="dl">"</span><span class="k">Emmanuel</span><span class="dl">"</span></span>, <span class="sy">:last_name</span> =&gt; <span class="s"><span class="dl">"</span><span class="k">Zorg</span><span class="dl">"</span></span>)</code></pre>&#x000A;  <br>&#x000A;</div>&#x000A;<div class="title">Save</div>&#x000A;<div class="text">&#x000A;  Saving a document to the database involves using <tt>Document#save</tt> or <tt>Document#save!</tt>.&#x000A;  Use the latter if you wish an exception to be raised if validation fails.&#x000A;  <pre><code class="language-ruby">person = <span class="co">Person</span>.new(<span class="sy">:first_name</span> =&gt; <span class="s"><span class="dl">"</span><span class="k">Syd</span><span class="dl">"</span></span>, <span class="sy">:last_name</span> =&gt; <span class="s"><span class="dl">"</span><span class="k">Vicious</span><span class="dl">"</span></span>)&#x000A;person.save <span class="c"># or person.upsert</span>&#x000A;&#x000A;person = <span class="co">Person</span>.new(<span class="sy">:first_name</span> =&gt; <span class="s"><span class="dl">"</span><span class="k">Emmanuel</span><span class="dl">"</span></span>, <span class="sy">:last_name</span> =&gt; <span class="s"><span class="dl">"</span><span class="k">Zorg</span><span class="dl">"</span></span>)&#x000A;person.save!</code></pre>&#x000A;  <br>&#x000A;</div>&#x000A;<div class="title">Updating Attributes</div>&#x000A;<div class="text">&#x000A;  Writing new attributes to a document and saving it in a single call is handled via&#x000A;  <tt>Document#update_attributes</tt> and <tt>Document#update_attributes!</tt>.&#x000A;  Use the latter if you wish an exception to be raised if validation fails.&#x000A;  <pre><code class="language-ruby">person = <span class="co">Person</span>.new(<span class="sy">:first_name</span> =&gt; <span class="s"><span class="dl">"</span><span class="k">Syd</span><span class="dl">"</span></span>, <span class="sy">:last_name</span> =&gt; <span class="s"><span class="dl">"</span><span class="k">Vicious</span><span class="dl">"</span></span>)&#x000A;person.update_attributes(<span class="sy">:first_name</span> =&gt; <span class="s"><span class="dl">"</span><span class="k">Nancy</span><span class="dl">"</span></span>)&#x000A;&#x000A;person = <span class="co">Person</span>.new(<span class="sy">:first_name</span> =&gt; <span class="s"><span class="dl">"</span><span class="k">Emmanuel</span><span class="dl">"</span></span>, <span class="sy">:last_name</span> =&gt; <span class="s"><span class="dl">"</span><span class="k">Zorg</span><span class="dl">"</span></span>)&#x000A;person.update_attributes!(<span class="sy">:first_name</span> =&gt; <span class="s"><span class="dl">"</span><span class="k">Nancy</span><span class="dl">"</span></span>)</code></pre>&#x000A;  <br>&#x000A;</div>&#x000A;<div class="title">Destroy</div>&#x000A;<div class="text">&#x000A;  Deleting objects from the database involves calling either <tt>Document#destroy</tt>,&#x000A;  <tt>Document#delete</tt>, <tt>Document.destroy_all</tt>, or <tt>Document.delete_all</tt>.&#x000A;  The first two will delete a single document, while the second two will delete all&#x000A;  documents given a supplied criteria. Note that the delete methods will ignore all defined&#x000A;  callbacks. These can also be called on associations.&#x000A;  <pre><code class="language-ruby">person = <span class="co">Person</span>.create(<span class="sy">:first_name</span> =&gt; <span class="s"><span class="dl">"</span><span class="k">Syd</span><span class="dl">"</span></span>, <span class="sy">:last_name</span> =&gt; <span class="s"><span class="dl">"</span><span class="k">Vicious</span><span class="dl">"</span></span>)&#x000A;person.destroy&#x000A;&#x000A;person = <span class="co">Person</span>.create(<span class="sy">:first_name</span> =&gt; <span class="s"><span class="dl">"</span><span class="k">Syd</span><span class="dl">"</span></span>, <span class="sy">:last_name</span> =&gt; <span class="s"><span class="dl">"</span><span class="k">Vicious</span><span class="dl">"</span></span>)&#x000A;person.delete&#x000A;&#x000A;<span class="co">Person</span>.destroy_all(<span class="sy">:conditions</span> =&gt; { <span class="sy">:first_name</span> =&gt; <span class="s"><span class="dl">"</span><span class="k">Syd</span><span class="dl">"</span></span>, <span class="sy">:last_name</span> =&gt; <span class="s"><span class="dl">"</span><span class="k">Vicious</span><span class="dl">"</span></span> })&#x000A;<span class="co">Person</span>.delete_all(<span class="sy">:conditions</span> =&gt; { <span class="sy">:first_name</span> =&gt; <span class="s"><span class="dl">"</span><span class="k">Syd</span><span class="dl">"</span></span>, <span class="sy">:last_name</span> =&gt; <span class="s"><span class="dl">"</span><span class="k">Vicious</span><span class="dl">"</span></span> })&#x000A;&#x000A;person.addresses.delete_all&#x000A;person.addresses.destroy_all(<span class="sy">:conditions</span> =&gt; { <span class="sy">:street</span> =&gt; <span class="s"><span class="dl">"</span><span class="k">Bond St</span><span class="dl">"</span></span> })</code></pre>&#x000A;  <br>&#x000A;</div>&#x000A;<div class="title">Persisting in Safe Mode</div>&#x000A;<div class="text">&#x000A;  Even though Mongoid provides the global configuration option for persisting&#x000A;  in safe mode, if you are using the default you may use safe mode on a per&#x000A;  query basis. Just prepend a <tt>safely</tt> in front of your persistence&#x000A;  command:&#x000A;  <pre><code class="language-ruby"><span class="co">Person</span>.safely.create(<span class="sy">:title</span> =&gt; <span class="s"><span class="dl">"</span><span class="k">King</span><span class="dl">"</span></span>)&#x000A;<span class="co">Person</span>.safely.delete_all&#x000A;&#x000A;person.safely.save&#x000A;person.safely.destroy</code></pre>&#x000A;  <br>&#x000A;</div>&#x000A;<div class="title">Explicit Modifiers</div>&#x000A;<div class="text">&#x000A;  Mongoid supports explicit $inc modification.&#x000A;  <pre><code class="language-ruby">person = <span class="co">Person</span>.find(id)&#x000A;person.inc(<span class="sy">:score</span>, <span class="i">100</span>)&#x000A;person.safely.inc(<span class="sy">:score</span>, <span class="i">100</span>) <span class="c"># Update in safe mode.</span></code></pre>&#x000A;  <br>&#x000A;</div>&#x000A;<div class="title">Persistence Strategies and Underlying DB Queries</div>&#x000A;<div class="text">&#x000A;  For all following examples, the following models will be used:&#x000A;  <pre><code class="language-ruby"><span class="r">class</span> <span class="cl">Person</span>&#x000A;  include <span class="co">Mongoid</span>::<span class="co">Document</span>&#x000A;  field <span class="sy">:first_name</span>&#x000A;  field <span class="sy">:middle_initial</span>&#x000A;  field <span class="sy">:last_name</span>&#x000A;  embeds_one <span class="sy">:email</span>&#x000A;  embeds_many <span class="sy">:addresses</span>&#x000A;<span class="r">end</span>&#x000A;&#x000A;<span class="r">class</span> <span class="cl">Address</span>&#x000A;  include <span class="co">Mongoid</span>::<span class="co">Document</span>&#x000A;  field <span class="sy">:street</span>&#x000A;  field <span class="sy">:post_code</span>&#x000A;  field <span class="sy">:state</span>&#x000A;  embedded_in <span class="sy">:person</span>, <span class="sy">:inverse_of</span> =&gt; <span class="sy">:addresses</span>&#x000A;<span class="r">end</span>&#x000A;&#x000A;<span class="r">class</span> <span class="cl">Email</span>&#x000A;  include <span class="co">Mongoid</span>::<span class="co">Document</span>&#x000A;  field <span class="sy">:address</span>&#x000A;  embedded_in <span class="sy">:person</span>, <span class="sy">:inverse_of</span> =&gt; <span class="sy">:email</span>&#x000A;<span class="r">end</span></code></pre>&#x000A;</div>&#x000A;<br><div class="title">Saving New Records</div>&#x000A;<div class="text">&#x000A;  <tt>Scenario:</tt> Saving a new root document. This will perform an <tt>insert</tt> on the MongoDB&#x000A;  collection with all the fields on the document:&#x000A;  <br><br><i>In Mongoid:</i>&#x000A;  <pre><code class="language-ruby">person = <span class="co">Person</span>.new(<span class="sy">:first_name</span> =&gt; <span class="s"><span class="dl">"</span><span class="k">Dudley</span><span class="dl">"</span></span>)&#x000A;person.save</code></pre>&#x000A;  <i>The MongoDB query:</i>&#x000A;  <pre><code class="language-javascript">db.people.insert({ <span class="ke"><span class="dl">"</span><span class="k">first_name</span><span class="dl">"</span></span> : <span class="s"><span class="dl">"</span><span class="k">Dudley</span><span class="dl">"</span></span> }, <span class="pc">true</span>);</code></pre>&#x000A;  <br><tt>Scenario:</tt> Saving a new root document with new children. This will perform&#x000A;  an <tt>insert</tt> on the MongoDB collection with all the fields on the document and&#x000A;  its children, no matter where the save call was executed from:&#x000A;  <br><br><i>In Mongoid:</i>&#x000A;  <pre><code class="language-ruby">person = <span class="co">Person</span>.new(<span class="sy">:first_name</span> =&gt; <span class="s"><span class="dl">"</span><span class="k">Dudley</span><span class="dl">"</span></span>)&#x000A;address = <span class="co">Address</span>.new(<span class="sy">:street</span> =&gt; <span class="s"><span class="dl">"</span><span class="k">Upper Street</span><span class="dl">"</span></span>)&#x000A;person.addresses &lt;&lt; address&#x000A;person.save <span class="c"># or address.save will yield same result.</span></code></pre>&#x000A;  <i>The MongoDB query:</i>&#x000A;  <pre><code class="language-javascript">db.people.insert(&#x000A;  { <span class="ke"><span class="dl">"</span><span class="k">first_name</span><span class="dl">"</span></span> : <span class="s"><span class="dl">"</span><span class="k">Dudley</span><span class="dl">"</span></span>, <span class="ke"><span class="dl">"</span><span class="k">addresses</span><span class="dl">"</span></span> : [ { <span class="ke"><span class="dl">"</span><span class="k">street</span><span class="dl">"</span></span> : <span class="s"><span class="dl">"</span><span class="k">Upper Street</span><span class="dl">"</span></span> } ] },&#x000A;  <span class="pc">true</span>&#x000A;);</code></pre>&#x000A;  <br><tt>Scenario:</tt> Saving a new <tt>embeds_one</tt> on an existing root document. This will&#x000A;  perform an atomic update on the root document with the new embedded attributes. The save must&#x000A;  be called from the child in this case:&#x000A;  <br><br><i>In Mongoid:</i>&#x000A;  <pre><code class="language-ruby">person = <span class="co">Person</span>.where(<span class="sy">:first_name</span> =&gt; <span class="s"><span class="dl">"</span><span class="k">Dudley</span><span class="dl">"</span></span>).first&#x000A;email = <span class="co">Email</span>.new(<span class="sy">:address</span> =&gt; <span class="s"><span class="dl">"</span><span class="k">dudley@moore.com</span><span class="dl">"</span></span>)&#x000A;person.email = email&#x000A;email.save</code></pre>&#x000A;  <i>The MongoDB query: (Assume person.id = "4baa56f1230048567300485c")</i>&#x000A;  <pre><code class="language-javascript">db.people.update(&#x000A;  { <span class="ke"><span class="dl">"</span><span class="k">_id</span><span class="dl">"</span></span> : <span class="s"><span class="dl">"</span><span class="k">4baa56f1230048567300485c</span><span class="dl">"</span></span> },&#x000A;  { <span class="ke"><span class="dl">"</span><span class="k">$set</span><span class="dl">"</span></span> : { <span class="ke"><span class="dl">"</span><span class="k">email</span><span class="dl">"</span></span> : { <span class="ke"><span class="dl">"</span><span class="k">address</span><span class="dl">"</span></span> : <span class="s"><span class="dl">"</span><span class="k">dudley@moore.com</span><span class="dl">"</span></span> } } },&#x000A;  <span class="pc">false</span>,&#x000A;  <span class="pc">true</span>&#x000A;);</code></pre>&#x000A;  <br><tt>Scenario:</tt> Saving a new <tt>embeds_many</tt> on an existing root document. This will&#x000A;  perform an atomic push on the root document embedded array with the new embedded attributes.&#x000A;  The save must be called from the child in this case:&#x000A;  <br><br><i>In Mongoid:</i>&#x000A;  <pre><code class="language-ruby">person = <span class="co">Person</span>.where(<span class="sy">:first_name</span> =&gt; <span class="s"><span class="dl">"</span><span class="k">Dudley</span><span class="dl">"</span></span>).first&#x000A;address = <span class="co">Address</span>.new(<span class="sy">:street</span> =&gt; <span class="s"><span class="dl">"</span><span class="k">Upper Street</span><span class="dl">"</span></span>)&#x000A;person.addresses &lt;&lt; address&#x000A;address.save</code></pre>&#x000A;  <i>The MongoDB query: (Assume person.id = "4baa56f1230048567300485c")</i>&#x000A;  <pre><code class="language-javascript">db.people.update(&#x000A;  { <span class="ke"><span class="dl">"</span><span class="k">_id</span><span class="dl">"</span></span> : <span class="s"><span class="dl">"</span><span class="k">4baa56f1230048567300485c</span><span class="dl">"</span></span> },&#x000A;  { <span class="ke"><span class="dl">"</span><span class="k">$push</span><span class="dl">"</span></span> : { <span class="ke"><span class="dl">"</span><span class="k">addresses</span><span class="dl">"</span></span> : { <span class="ke"><span class="dl">"</span><span class="k">street</span><span class="dl">"</span></span> : <span class="s"><span class="dl">"</span><span class="k">Upper Street</span><span class="dl">"</span></span> } } },&#x000A;  <span class="pc">false</span>,&#x000A;  <span class="pc">true</span>&#x000A;);</code></pre>&#x000A;</div>&#x000A;<br><div class="title">Updating Existing Records</div>&#x000A;<div class="text">&#x000A;  Updating existing records leverages Mongoid's dirty attributes module to only persist what&#x000A;  has changed on the documents. In all cases the save must be called on the document that has&#x000A;  been updated. (This will change in subsequent releases to check the entire tree.)&#x000A;  <br><br><tt>Scenario:</tt> Updating a root document. This will perform an atomic update on the dirty&#x000A;  attributes on the model:&#x000A;  <br><br><i>In Mongoid:</i>&#x000A;  <pre><code class="language-ruby">person = <span class="co">Person</span>.where(<span class="sy">:first_name</span> =&gt; <span class="s"><span class="dl">"</span><span class="k">Dudley</span><span class="dl">"</span></span>).first&#x000A;person.last_name = <span class="s"><span class="dl">"</span><span class="k">Moore</span><span class="dl">"</span></span>&#x000A;person.save</code></pre>&#x000A;  <i>The MongoDB query: (Assume person.id = "4baa56f1230048567300485c")</i>&#x000A;  <pre><code class="language-javascript">db.people.update(&#x000A;  { <span class="ke"><span class="dl">"</span><span class="k">_id</span><span class="dl">"</span></span> : <span class="s"><span class="dl">"</span><span class="k">4baa56f1230048567300485c</span><span class="dl">"</span></span> },&#x000A;  { <span class="ke"><span class="dl">"</span><span class="k">$set</span><span class="dl">"</span></span> : { <span class="ke"><span class="dl">"</span><span class="k">last_name</span><span class="dl">"</span></span> : <span class="s"><span class="dl">"</span><span class="k">Moore</span><span class="dl">"</span></span> } },&#x000A;  <span class="pc">false</span>,&#x000A;  <span class="pc">true</span>&#x000A;);</code></pre>&#x000A;  <br><tt>Scenario:</tt> Updating an existing <tt>embeds_one</tt>. This will perform an atomic&#x000A;  update on the existing embedded document.&#x000A;  <br><br><i>In Mongoid:</i>&#x000A;  <pre><code class="language-ruby">person = <span class="co">Person</span>.where(<span class="sy">:first_name</span> =&gt; <span class="s"><span class="dl">"</span><span class="k">Dudley</span><span class="dl">"</span></span>).first&#x000A;email = person.email&#x000A;email.address = <span class="s"><span class="dl">"</span><span class="k">dudley@moore.org</span><span class="dl">"</span></span>&#x000A;email.save</code></pre>&#x000A;  <i>The MongoDB query: (Assume person.id = "4baa56f1230048567300485c")</i>&#x000A;  <pre><code class="language-javascript">db.people.update(&#x000A;  { <span class="ke"><span class="dl">"</span><span class="k">_id</span><span class="dl">"</span></span> : <span class="s"><span class="dl">"</span><span class="k">4baa56f1230048567300485c</span><span class="dl">"</span></span> },&#x000A;  { <span class="ke"><span class="dl">"</span><span class="k">$set</span><span class="dl">"</span></span> : { <span class="ke"><span class="dl">"</span><span class="k">email.address</span><span class="dl">"</span></span> : <span class="s"><span class="dl">"</span><span class="k">dudley@moore.org</span><span class="dl">"</span></span> } },&#x000A;  <span class="pc">false</span>,&#x000A;  <span class="pc">true</span>&#x000A;);</code></pre>&#x000A;  <br><tt>Scenario:</tt> Updating an existing <tt>embeds_many</tt>. This will perform an atomic&#x000A;  update on the existing embedded document based on its position in the array.&#x000A;  <br><br><i>In Mongoid:</i>&#x000A;  <pre><code class="language-ruby">person = <span class="co">Person</span>.where(<span class="sy">:first_name</span> =&gt; <span class="s"><span class="dl">"</span><span class="k">Dudley</span><span class="dl">"</span></span>).first&#x000A;address = person.addresses.first&#x000A;address.street = <span class="s"><span class="dl">"</span><span class="k">Clerkenwell Road</span><span class="dl">"</span></span>&#x000A;address.save</code></pre>&#x000A;  <i>The MongoDB query: (Assume person.id = "4baa56f1230048567300485c")</i>&#x000A;  <pre><code class="language-javascript">db.people.update(&#x000A;  { <span class="ke"><span class="dl">"</span><span class="k">_id</span><span class="dl">"</span></span> : <span class="s"><span class="dl">"</span><span class="k">4baa56f1230048567300485c</span><span class="dl">"</span></span> },&#x000A;  { <span class="ke"><span class="dl">"</span><span class="k">$set</span><span class="dl">"</span></span> : { <span class="ke"><span class="dl">"</span><span class="k">addresses.0.street</span><span class="dl">"</span></span> : <span class="s"><span class="dl">"</span><span class="k">Clerkenwell Road</span><span class="dl">"</span></span> } },&#x000A;  <span class="pc">false</span>,&#x000A;  <span class="pc">true</span>&#x000A;);</code></pre>&#x000A;</div>&#x000A;<br><div class="title">Mixed Persistence</div>&#x000A;<div class="text">&#x000A;  Note that when Mongoid persists, it looks at the document the persistence command was&#x000A;  executed and does an atomic update of all of its updates, as well as any changes embedded&#x000A;  below it in the hierarchy. This is handy for operating on the entire tree, and getting&#x000A;  a single database call for the changes. Note that as of beta8, deletion does not work in&#x000A;  this context, it has to be done separately.&#x000A;  <br><br><tt>Scenario:</tt> Updating a root document, a child document, and adding a new child.&#x000A;  <br><br><i>In Mongoid:</i>&#x000A;  <pre><code class="language-ruby">person = <span class="co">Person</span>.where(<span class="sy">:first_name</span> =&gt; <span class="s"><span class="dl">"</span><span class="k">Dudley</span><span class="dl">"</span></span>).first&#x000A;person.last_name = <span class="s"><span class="dl">"</span><span class="k">Moore</span><span class="dl">"</span></span>&#x000A;person.email.address = <span class="s"><span class="dl">"</span><span class="k">d.moore@gmail.com</span><span class="dl">"</span></span>&#x000A;person.addresses.build(<span class="sy">:street</span> =&gt; <span class="s"><span class="dl">"</span><span class="k">Upper Street</span><span class="dl">"</span></span>)&#x000A;person.save</code></pre>&#x000A;  <i>The MongoDB query: (Assume person.id = "4baa56f1230048567300485c")</i>&#x000A;  <pre><code class="language-javascript">db.people.update(&#x000A;  { <span class="ke"><span class="dl">"</span><span class="k">_id</span><span class="dl">"</span></span> : <span class="s"><span class="dl">"</span><span class="k">4baa56f1230048567300485c</span><span class="dl">"</span></span> },&#x000A;  {&#x000A;    <span class="ke"><span class="dl">"</span><span class="k">$set</span><span class="dl">"</span></span> :&#x000A;    { <span class="ke"><span class="dl">"</span><span class="k">last_name</span><span class="dl">"</span></span> : <span class="s"><span class="dl">"</span><span class="k">Moore</span><span class="dl">"</span></span>, <span class="ke"><span class="dl">"</span><span class="k">email.address</span><span class="dl">"</span></span> : <span class="s"><span class="dl">"</span><span class="k">d.moore@gmail.com</span><span class="dl">"</span></span> },&#x000A;    <span class="ke"><span class="dl">"</span><span class="k">$push</span><span class="dl">"</span></span> :&#x000A;    { <span class="ke"><span class="dl">"</span><span class="k">addresses</span><span class="dl">"</span></span> : { <span class="ke"><span class="dl">"</span><span class="k">street</span><span class="dl">"</span></span> : <span class="s"><span class="dl">"</span><span class="k">Upper Street</span><span class="dl">"</span></span> } }&#x000A;  },&#x000A;  <span class="pc">false</span>,&#x000A;  <span class="pc">true</span>&#x000A;);</code></pre>&#x000A;</div>&#x000A;<br><div class="title">Deleting Records</div>&#x000A;<div class="text">&#x000A;  <tt>Scenario:</tt> Deleting an existing root document. This will perform a <tt>remove</tt>&#x000A;  on the MongoDB collection with the document's id&#x000A;  <br><br><i>The MongoDB query: (Assume person.id = "4baa56f1230048567300485c")</i>&#x000A;  <pre><code class="language-ruby">person = <span class="co">Person</span>.where(<span class="sy">:first_name</span> =&gt; <span class="s"><span class="dl">"</span><span class="k">Dudley</span><span class="dl">"</span></span>).first&#x000A;person.delete <span class="c"># also destroy works here.</span></code></pre>&#x000A;  <i>The MongoDB query:</i>&#x000A;  <pre><code class="language-javascript">db.people.remove({ <span class="ke"><span class="dl">"</span><span class="k">_id</span><span class="dl">"</span></span> : <span class="s"><span class="dl">"</span><span class="k">4baa56f1230048567300485c</span><span class="dl">"</span></span> }, <span class="pc">true</span>);</code></pre>&#x000A;  <br><tt>Scenario:</tt> Deleting an existing <tt>embeds_one</tt>. This will perform an atomic&#x000A;  unset on the embedded document.&#x000A;  <br><br><i>In Mongoid:</i>&#x000A;  <pre><code class="language-javascript">person = Person.where(:first_name =&gt; <span class="s"><span class="dl">"</span><span class="k">Dudley</span><span class="dl">"</span></span>).first&#x000A;email = person.email&#x000A;email.<span class="kw">delete</span> <span class="er">#</span> or destroy</code></pre>&#x000A;  <i>The MongoDB query: (Assume person.id = "4baa56f1230048567300485c")</i>&#x000A;  <pre><code class="language-javascript">db.people.update(&#x000A;  { <span class="ke"><span class="dl">"</span><span class="k">_id</span><span class="dl">"</span></span> : <span class="s"><span class="dl">"</span><span class="k">4baa56f1230048567300485c</span><span class="dl">"</span></span> },&#x000A;  { <span class="ke"><span class="dl">"</span><span class="k">$unset</span><span class="dl">"</span></span> : { <span class="ke"><span class="dl">"</span><span class="k">email</span><span class="dl">"</span></span> : <span class="pc">true</span> } },&#x000A;  <span class="pc">false</span>,&#x000A;  <span class="pc">true</span>&#x000A;);</code></pre>&#x000A;  <br><tt>Scenario:</tt> Deleting an existing document in an <tt>embeds_many</tt>. This will&#x000A;  perform an atomic pull on the existing embedded document in the array.&#x000A;  <br><br><i>In Mongoid:</i>&#x000A;  <pre><code class="language-ruby">person = <span class="co">Person</span>.where(<span class="sy">:first_name</span> =&gt; <span class="s"><span class="dl">"</span><span class="k">Dudley</span><span class="dl">"</span></span>).first&#x000A;address = person.addresses.first&#x000A;address.delete <span class="c"># or destroy</span></code></pre>&#x000A;  <i>The MongoDB query:</i>&#x000A;  <br><i>(Assume person.id = "4baa56f1230048567300485c")</i>&#x000A;  <br><i>(Assume address.id = "4baa56f1230048567300485d")</i>&#x000A;  <pre><code class="language-javascript">db.people.update(&#x000A;  { <span class="ke"><span class="dl">"</span><span class="k">_id</span><span class="dl">"</span></span> : <span class="s"><span class="dl">"</span><span class="k">4baa56f1230048567300485c</span><span class="dl">"</span></span> },&#x000A;  { <span class="ke"><span class="dl">"</span><span class="k">$pull</span><span class="dl">"</span></span> : { <span class="ke"><span class="dl">"</span><span class="k">addresses</span><span class="dl">"</span></span> : { <span class="ke"><span class="dl">"</span><span class="k">_id</span><span class="dl">"</span></span> : <span class="s"><span class="dl">"</span><span class="k">4baa56f1230048567300485d</span><span class="dl">"</span></span> } } },&#x000A;  <span class="pc">false</span>,&#x000A;  <span class="pc">true</span>&#x000A;);</code></pre>&#x000A;</div>&#x000A;&#x000A;
          </div>
        </div>
      </div>
      <div id='rightcolumn'>
        <div class='box' id='search'>
          <div class='roundedbox'>
            <h3>Contents</h3>
          </div>
        </div>
        <ul class='outline'>
          <li><a href="/docs/installation/">Installation</a></li>
          <li><a href="/docs/documents/">Documents</a></li>
          <li><a href="/docs/associations/">Associations</a></li>
          <li><span class="active" title="You're here.">Persistence</span></li>
          <li><a href="/docs/querying/">Querying</a></li>
          <li><a href="/docs/callbacks/">Callbacks</a></li>
          <li><a href="/docs/validation/">Validation</a></li>
          <li><a href="/docs/inheritance/">Inheritance</a></li>
          <li><a href="/docs/indexing/">Indexing</a></li>
          <li><a href="/docs/extras/">Extras</a></li>
          <li><a href="/docs/rake/">Rake Tasks</a></li>
          <li><a href="/docs/integration/">Integration</a></li>
          <li><a href="/docs/extensions/">Extensions</a></li>
          <li><a href="/docs/upgrading/">Upgrading</a></li>
        </ul>
      </div>
      <div id='footer'>
        <p>
          Mongoid is maintained by <a href="http://twitter.com/modetojoy">Durran Jordan</a>, Site by <a href="http://twitter.com/railsjedi">@railsjedi</a> and <a href="http://twitter.com/fredrikhenne">@fredrikhenne</a>. Mongoid is free software under the MIT license.
        </p>
      </div>
    </div>
    <div id='ribbon'>
      <p>
        <a href='http://github.com/mongoid/mongoid-site' rel='me' title='Fork me on GitHub!'>Fork me on GitHub!</a>
      </p>
    </div>
  </body>
</html>
